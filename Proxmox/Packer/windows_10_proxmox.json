{
    "builders": [
      {
        "type":"proxmox",
        "proxmox_url":  "https://{{user `proxmox_host`}}:8006/api2/json",
        "insecure_skip_tls_verify": true,
        "username": "{{ user `proxmox_username` }}",
        "password": "{{ user `proxmox_password` }}",
        "vm_name": "Windows10",
        "node": "{{user `proxmox_node`}}",
        "sockets": 1,
        "cores": 2,  
        "cpu_type": "kvm64",
        "memory": 2048,
        "os": "win10",
        "network_adapters": [
          {
            "model": "virtio",
            "bridge": "{{user `proxmox_network_with_dhcp_and_internet`}}"
          }
        ],
        "disks": [
          {
            "type": "sata",
            "disk_size": "60G",
            "storage_pool": "local-lvm",
            "storage_pool_type": "lvm",
            "cache_mode": "writeback",
            "format": "qcow2"
          }
        ],
        "vga": {
          "type": "std",
          "memory": 256
        },
        "iso_file": "local:iso/en_windows10.iso",
        "additional_iso_files": [
          {
            "device": "sata3",
            "iso_file": "local:iso/Autounattend.iso",
            "iso_checksum": "BC3D71AE85DA5EA44D986E8FB9D42A9A",
            "unmount": true
          },
          {
            "device": "sata4",
            "iso_file": "local:iso/virtio-win-0.1.204.iso",
            "iso_checksum": "C97B2647B64F976C1D0BE9C841BC2869",
            "unmount": true
          }
        ],
        "communicator": "winrm",
        "winrm_username": "vagrant",
        "winrm_password": "vagrant",
        "winrm_timeout": "4h",
        "winrm_insecure": true,
        "winrm_use_ssl": true,
        "qemu_agent": true,
        "unmount_iso": true,
        "template_name": "Windows10",
        "template_description": "Windows 10, generated on {{ isotime \"2006-01-02T15:04:05Z\" }}"
      }
    ],
    "provisioners": [
      {
        "type": "windows-shell",
        "remote_path": "/tmp/script.bat",
        "execute_command": "{{ .Vars }} cmd /c \"{{ .Path }}\"",
        "scripts": [
          "../../Packer/scripts/vm-guest-tools.bat",
          "../../Packer/scripts/enable-rdp.bat"
        ]
      },
      {
        "type": "powershell",
        "scripts": [
          "../../Packer/scripts/debloat-windows.ps1"
        ]
      },
      {
        "type": "windows-restart"
      },
      {
        "type": "powershell",
        "scripts": [
          "../../Packer/scripts/set-powerplan.ps1",
          "../../Packer/scripts/docker/disable-windows-defender.ps1"
        ]
      },
      {
        "type": "windows-shell",
        "remote_path": "/tmp/script.bat",
        "execute_command": "{{ .Vars }} cmd /c \"{{ .Path }}\"",
        "scripts": [
          "../../Packer/scripts/pin-powershell.bat",
          "../../Packer/scripts/compile-dotnet-assemblies.bat",
          "../../Packer/scripts/set-winrm-automatic.bat",
          "../../Packer/scripts/dis-updates.bat"
      ]
    }
  ]
}